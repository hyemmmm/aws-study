# CloudTrail 로그 저장 방식 정리 (S3 vs CloudWatch Logs)

## 궁금한 점

1. S3는 로그가 순차적으로 저장되지 않는 건가?
2. 여기서 말하는 “스트림 형식”이 정확히 무엇인가?
3. S3는 파일 형태로 저장된다는데, 파일은 어떤 기준으로 나뉘는가?

---

# 1. S3는 로그가 순차적으로 저장되지 않는가?

아니다.  
**S3도 로그는 시간 순서대로 기록된다.**

CloudTrail 이벤트는 발생 시간 기준으로 기록되며,  
그 이벤트들이 일정 시간 단위로 모여 파일로 저장된다.

차이는 저장 구조에 있다.

- S3는 이벤트를 일정 시간 모아서
- `.json.gz` 파일 단위로 저장한다.

즉,

> 순차적으로 기록되지만  
> “흐르는 구조”가 아니라 “파일로 묶여 저장”되는 구조이다.

---

# 2. 여기서 말하는 “스트림 형식”이란?

스트림 형식이란:

> 로그가 발생하는 대로  
> 한 줄씩 계속 이어 붙는 저장 구조

중요한 점:

- 작업 단위가 아니다.
- 시작/끝 묶음이 아니다.
- 세션 단위가 아니다.

CloudWatch Logs에서는:

- 이벤트가 발생하면
- 거의 즉시
- 해당 스트림에 이어 붙는다.

그래서 “흐르는 형태”라고 표현한다.

---

## S3 vs CloudWatch Logs 핵심 차이

| 구분 | S3 | CloudWatch Logs |
|------|----|----------------|
| 순차성 | 있음 | 있음 |
| 저장 단위 | 파일 | 이벤트 흐름 |
| 실시간성 | 낮음 | 높음 |
| 구조 | 정적 파일 저장 | append-only 스트림 |

핵심 차이는:

> 파일 기반 저장 vs 흐름 기반 저장

---

# 3. S3에서 파일이 나뉘는 기준

CloudTrail 로그는 S3에 다음 기준으로 나뉘어 저장된다:

- 계정
- 리전
- 날짜
- 시간 구간 (보통 몇 분 단위)

예시 경로: AWSLogs/계정ID/CloudTrail/리전/연/월/일/xxxx.json.gz

# 실무에서는 언제 S3를 쓰고, 언제 CloudWatch Logs를 쓰는가?

## ✅ S3 저장이 적합한 경우

목적: **장기 보관 / 감사 / 비용 최적화**

- 수개월~수년 단위 로그 보관이 필요한 경우
- 규정 준수(ISMS, ISO 등) 대응
- 보안 감사 및 사후 분석
- 전체 로그를 비용 효율적으로 보관해야 하는 경우
- Athena(S3에 저장된 데이터를 SQL로 조회할 수 있게 해주는 서비스)로 과거 로그를 분석하는 경우

> 보관 중심이면 S3가 기본 선택이다.

---

## ✅ CloudWatch Logs 저장이 적합한 경우

목적: **운영 중 빠른 검색 / 실시간 가시성**

- 특정 API 호출을 바로 확인해야 하는 경우
- 운영 중 장애 원인을 빠르게 추적해야 하는 경우
- 특정 이벤트 발생 시 알림을 설정하고 싶은 경우
- 보안팀이 실시간 모니터링을 하는 경우

> 운영 분석 중심이면 CloudWatch Logs를 추가한다.

## ✅ 실무에서 가장 흔한 구성

대부분의 운영 환경에서는:

- S3는 기본으로 활성화
- 필요 시 CloudWatch Logs도 함께 활성화


